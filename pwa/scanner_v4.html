<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner | Vantage</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Inter:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/pwa/css/main.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        midnight: '#020617',
                        slate: {
                            800: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        },
                        primary: '#2563eb',
                    }
                }
            }
        }
    </script>
    <style>
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .terminal-bg {
            background: rgba(0, 0, 0, 0.4);
            font-family: 'JetBrains Mono', monospace;
        }

        .log-entry {
            border-left: 2px solid transparent;
            padding-left: 1rem;
            margin-bottom: 0.25rem;
        }

        .log-info {
            border-left-color: #64748b;
            color: #94a3b8;
        }

        .log-success {
            border-left-color: #10b981;
            color: #34d399;
        }

        .log-error {
            border-left-color: #f43f5e;
            color: #fb7185;
        }

        .log-warn {
            border-left-color: #f59e0b;
            color: #fbbf24;
        }
    </style>
</head>

<body class="flex h-screen overflow-hidden bg-slate-950 text-slate-200">

    <!-- Sidebar (Desktop) -->
    <aside class="hidden md:flex flex-col w-72 bg-slate-900 border-r border-white/5 z-30">
        <div class="p-8">
            <div class="flex items-center gap-3 group cursor-pointer" onclick="window.location.href='/'">
                <div
                    class="w-10 h-10 rounded-xl bg-primary flex items-center justify-center relative overflow-hidden shrink-0 shadow-lg shadow-primary/20">
                    <img src="/vantage_logo.png" class="w-full h-full object-cover p-1.5"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                    <span style="display:none" class="text-xl h-full w-full items-center justify-center">V</span>
                </div>
                <div>
                    <h1 class="font-heading font-bold text-xl tracking-tight text-white">Vantage</h1>
                    <p class="text-[9px] text-primary font-bold tracking-widest uppercase opacity-80">Intelligence
                        Platform</p>
                </div>
            </div>
        </div>

        <nav class="flex-1 px-3 space-y-1 overflow-y-auto no-scrollbar">
            <div class="px-4 py-3 text-[10px] font-bold text-slate-500 uppercase tracking-widest opacity-50">Main Menu
            </div>
            <a href="/" class="sidebar-link"><i class="fas fa-grid-2 w-5 text-sm"></i><span>Dashboard</span></a>
            <a href="/scanner" class="sidebar-link active"><i class="fas fa-sync-alt w-5 text-sm"></i><span>Sync
                    Center</span></a>

            <div class="px-4 py-6 text-[10px] font-bold text-slate-500 uppercase tracking-widest opacity-50">
                Configuration</div>
            <a href="/admin" class="sidebar-link"><i class="fas fa-shield-alt w-5 text-sm"></i><span>Terminal</span></a>
            <a href="/settings" class="sidebar-link"><i
                    class="fas fa-sliders-h w-5 text-sm"></i><span>Settings</span></a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col relative overflow-hidden bg-slate-950">
        <header
            class="h-16 flex items-center justify-between px-8 border-b border-white/5 bg-slate-900/50 backdrop-blur-md sticky top-0 z-20">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()"
                    class="md:hidden bg-slate-900 p-2 rounded-lg border border-white/5 text-slate-400">
                    <i class="fas fa-bars"></i>
                </button>
                <h2 class="font-heading font-bold text-lg text-white">Sync Center</h2>
                <div class="h-4 w-px bg-white/10 mx-2 hidden md:block"></div>
                <div id="statusIndicator"
                    class="flex items-center gap-2 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/20">
                    <div class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></div>
                    <span class="text-[9px] font-bold text-emerald-400 uppercase tracking-widest">System Online</span>
                </div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-6 md:p-8 no-scrollbar pb-32">
            <div class="max-w-4xl mx-auto space-y-8">

                <!-- TikTokCopilot Sync Panel -->
                <div
                    class="bg-slate-900 border border-white/5 rounded-2xl p-8 md:p-10 relative overflow-hidden shadow-2xl">
                    <div class="absolute top-0 right-0 p-8 opacity-5">
                        <i class="fas fa-cloud-download-alt text-9xl"></i>
                    </div>

                    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-10 relative z-10">
                        <div>
                            <h3 class="text-xl font-heading font-bold text-white mb-2 flex items-center gap-3">
                                <i class="fas fa-bolt text-primary"></i>
                                Partner Sync Protocol
                            </h3>
                            <p class="text-slate-400 text-xs">Synchronize latest market data vectors including ad spend,
                                revenue, and engagement metrics.</p>
                        </div>
                        <button onclick="runCopilotSync(this)" id="btnSync"
                            class="btn-premium px-8 py-3 shadow-lg shadow-primary/20">
                            <i class="fas fa-sync-alt mr-2"></i> Execute Sync
                        </button>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 relative z-10">
                        <div>
                            <label
                                class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Time
                                Horizon</label>
                            <div class="relative">
                                <select id="sync-timeframe"
                                    class="w-full bg-slate-950 border border-white/10 rounded-xl py-2.5 px-3 text-xs text-white focus:outline-none focus:border-primary/50 appearance-none font-bold">
                                    <option value="1d">24 Hours</option>
                                    <option value="3d">3 Days</option>
                                    <option value="7d" selected>7 Days</option>
                                    <option value="14d">14 Days</option>
                                    <option value="30d">30 Days</option>
                                </select>
                                <i
                                    class="fas fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-slate-600 text-[10px] pointer-events-none"></i>
                            </div>
                        </div>
                        <div>
                            <label
                                class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Limit
                                / Page</label>
                            <input type="number" id="sync-limit" value="50"
                                class="w-full bg-slate-950 border border-white/10 rounded-xl py-2.5 px-3 text-xs text-white focus:outline-none focus:border-primary/50 font-bold">
                        </div>
                        <div>
                            <label
                                class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Starting
                                Page</label>
                            <input type="number" id="sync-page" value="0"
                                class="w-full bg-slate-950 border border-white/10 rounded-xl py-2.5 px-3 text-xs text-white focus:outline-none focus:border-primary/50 font-bold">
                        </div>
                        <div>
                            <label
                                class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Batch
                                Size</label>
                            <input type="number" id="sync-pages" value="3"
                                class="w-full bg-slate-950 border border-white/10 rounded-xl py-2.5 px-3 text-xs text-white focus:outline-none focus:border-primary/50 font-bold">
                        </div>
                    </div>

                    <div class="bg-slate-950/50 p-4 rounded-xl border border-white/5 relative z-10">
                        <p class="text-[9px] font-bold text-primary uppercase tracking-widest mb-2">Protocol Output:</p>
                        <ul class="text-[10px] text-slate-400 space-y-1 list-disc ml-4">
                            <li>Trending products ranked by <span class="text-white">revenue velocity</span></li>
                            <li>Metrics: Ad Spend, Video Count, Creator Volume, GMV</li>
                            <li>Automatic filtration of low-quality placeholders</li>
                            <li class="text-slate-500">Estimated Yield: ~150 datasets per batch</li>
                        </ul>
                    </div>
                </div>

                <!-- Terminal Log -->
                <div
                    class="bg-slate-900 border border-white/5 rounded-2xl overflow-hidden h-[400px] flex flex-col shadow-2xl">
                    <div class="px-6 py-3 bg-white/5 border-b border-white/5 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-terminal text-slate-600 text-xs"></i>
                            <span class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">System
                                Log</span>
                        </div>
                        <button onclick="document.getElementById('consoleLog').innerHTML = ''"
                            class="text-[10px] font-bold text-slate-500 hover:text-white uppercase tracking-widest transition-colors">Clear</button>
                    </div>
                    <div id="consoleLog"
                        class="flex-1 overflow-y-auto p-6 space-y-2 font-mono text-[11px] leading-relaxed text-slate-400">
                        <div class="log-entry log-info border-l-2 border-slate-700 pl-3">
                            <span class="opacity-50 text-[10px] mr-2">SYSTEM</span>
                            <span>Ready for synchronization. Awaiting operator command.</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script>
        function log(msg, type = 'info') {
            const c = document.getElementById('consoleLog');
            const d = document.createElement('div');
            d.className = `log-entry log-${type}`;
            d.innerHTML = `<span class="opacity-30">[${new Date().toLocaleTimeString()}]</span> ${msg}`;
            c.appendChild(d);
            c.scrollTop = c.scrollHeight;
        }

        async function runCopilotSync(btn) {
            const timeframe = document.getElementById('sync-timeframe').value;
            const limit = parseInt(document.getElementById('sync-limit').value) || 50;
            const startPage = parseInt(document.getElementById('sync-page').value) || 0;
            const pageCount = parseInt(document.getElementById('sync-pages').value) || 1;

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Syncing...';

            log(`Starting Copilot sync: ${pageCount} pages, ${limit}/page, ${timeframe} horizon...`, 'info');

            let totalSaved = 0;
            let totalFetched = 0;

            try {
                for (let i = 0; i < pageCount; i++) {
                    const page = startPage + i;
                    log(`Fetching page ${page + 1}...`, 'info');

                    const res = await fetch('/api/copilot/sync', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ timeframe, limit, page })
                    });

                    const data = await res.json();

                    if (data.success) {
                        totalSaved += data.saved;
                        totalFetched += data.total_in_response;
                        log(`>> Page ${page + 1}: Saved ${data.saved}/${data.total_in_response} products`, 'success');
                    } else {
                        log(`!! Page ${page + 1} failed: ${data.error}`, 'error');
                    }

                    // Rate limit protection
                    await new Promise(r => setTimeout(r, 1500));
                }

                log(`âœ… SYNC COMPLETE: ${totalSaved} products saved (${totalFetched} fetched, remainder filtered as placeholders)`, 'success');

            } catch (e) {
                log(`System Error: ${e.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> Sync Now';
            }
        }

        function toggleSidebar() {
            const aside = document.querySelector('aside');
            if (aside.classList.contains('hidden')) {
                aside.classList.remove('hidden');
                aside.classList.add('fixed', 'inset-0', 'bg-slate-900', 'z-50');
                if (!document.getElementById('mobile-sidebar-close')) {
                    const closeBtn = document.createElement('button');
                    closeBtn.id = 'mobile-sidebar-close';
                    closeBtn.className = 'absolute top-8 right-8 glass p-3 rounded-2xl border-white/5 text-white';
                    closeBtn.innerHTML = '<i class="fas fa-times"></i>';
                    closeBtn.onclick = toggleSidebar;
                    aside.appendChild(closeBtn);
                }
            } else {
                aside.classList.add('hidden');
                aside.classList.remove('fixed', 'inset-0', 'bg-slate-900', 'z-50');
                const closeBtn = document.getElementById('mobile-sidebar-close');
                if (closeBtn) closeBtn.remove();
            }
        }
    </script>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav">
        <a href="/" class="mobile-nav-item"><i class="fas fa-th-large"></i><span>Intel</span></a>
        <a href="/scanner" class="mobile-nav-item active"><i class="fas fa-sync-alt"></i><span>Sync</span></a>
        <!-- Mobile Shops Disabled -->
        <a href="/settings" class="mobile-nav-item"><i class="fas fa-cog"></i><span>Setup</span></a>
    </nav>
</body>

</html>